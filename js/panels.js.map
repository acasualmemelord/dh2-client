{"version":3,"file":"panels.js","names":["PSRouter","roomid","panelState","currentRoomid","location","pathname","slice","test","subscribeHistory","endsWith","subscribeHash","_proto","prototype","hash","PS","join","subscribeAndRun","room","id","window","addEventListener","e","possibleRoomid","_this","history","leftRoomWidth","leftRoom","rightRoom","pushState","title","replaceState","state","_ref","split","leftRoomid","rightRoomid","router","PSRoomPanel","_preact$Component","_inheritsLoose","_this2","_len","arguments","length","args","Array","_key","call","apply","concat","subscriptions","_proto2","componentDidMount","_this3","props","focus","onParentEvent","push","subscribe","forceUpdate","receiveLine","base","setDimensions","offsetWidth","offsetHeight","componentDidUpdate","includes","componentWillUnmount","_i2","_this$subscriptions2","subscription","unsubscribe","chooseParentValue","value","dropdownButton","parentElem","changeEvent","Event","dispatchEvent","closePopup","render","preact","h","PSPanelWrapper","Component","children","style","PSMain","getPopupStyle","width","posStyle","scrollable","_preact$Component2","_this4","_elem","elem","target","className","preventDefault","stopImmediatePropagation","clickedRoom","name","getAttribute","userid","toID","addRoom","parentRoomid","containingRoomid","rightPopup","username","update","tagName","roomidFromLink","handleButtonClick","startsWith","rooms","parentElement","popups","isTextInput","type","modifierKey","ctrlKey","altKey","metaKey","shiftKey","keyCode","arrowKeysUsed","focusLeftRoom","focusRightRoom","prefs","key","document","body","dark","_proto3","getRoom","curElem","leave","mainmenu","send","href","server","host","Config","routes","client","redirects","isEmptyClick","selection","getSelection","err","BattleTooltips","hideTooltip","pos","activePanel","top","right","left","display","height","bottom","RangeError","position","visibility","margin","offset","getBoundingClientRect","sourceWidth","sourceHeight","availableHeight","documentElement","clientHeight","Math","max","offsetLeft","clientWidth","availableWidth","maxWidth","renderRoom","roomType","roomTypes","Panel","renderPopup","_this5","PSHeader","map"],"sources":["../src/panels.tsx"],"sourcesContent":["/**\r\n * Panels\r\n *\r\n * Main view - sets up the frame, and the generic panels.\r\n *\r\n * Also sets up global event listeners.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nclass PSRouter {\r\n\troomid = '' as RoomID;\r\n\tpanelState = '';\r\n\tconstructor() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\tthis.subscribeHistory();\r\n\t\t} else if (location.pathname.endsWith('.html')) {\r\n\t\t\tthis.subscribeHash();\r\n\t\t}\r\n\t}\r\n\tsubscribeHash() {\r\n\t\tif (location.hash) {\r\n\t\t\tconst currentRoomid = location.hash.slice(1);\r\n\t\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tPS.subscribeAndRun(() => {\r\n\t\t\tconst roomid = PS.room.id;\r\n\t\t\tlocation.hash = roomid ? '#' + roomid : '';\r\n\t\t});\r\n\t\twindow.addEventListener('hashchange', e => {\r\n\t\t\tconst possibleRoomid = location.hash.slice(1);\r\n\t\t\tlet currentRoomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\tcurrentRoomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (currentRoomid !== null) {\r\n\t\t\t\tPS.join(currentRoomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tsubscribeHistory() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!window.history) return;\r\n\t\tPS.subscribeAndRun(() => {\r\n\t\t\tconst room = PS.room;\r\n\t\t\tconst roomid = room.id;\r\n\t\t\tconst panelState = (PS.leftRoomWidth ?\r\n\t\t\t\tPS.leftRoom.id + '..' + PS.rightRoom!.id :\r\n\t\t\t\troomid);\r\n\t\t\tif (roomid === this.roomid && panelState === this.panelState) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (panelState === this.panelState) {\r\n\t\t\t\thistory.pushState(panelState, room.title, '/' + roomid);\r\n\t\t\t} else {\r\n\t\t\t\thistory.replaceState(panelState, room.title, '/' + roomid);\r\n\t\t\t}\r\n\t\t\tthis.roomid = roomid;\r\n\t\t\tthis.panelState = panelState;\r\n\t\t});\r\n\t\twindow.addEventListener('popstate', e => {\r\n\t\t\tconst possibleRoomid = location.pathname.slice(1);\r\n\t\t\tlet roomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\troomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (typeof e.state === 'string') {\r\n\t\t\t\tconst [leftRoomid, rightRoomid] = e.state.split('..') as RoomID[];\r\n\t\t\t\tPS.join(leftRoomid, 'left');\r\n\t\t\t\tif (rightRoomid) {\r\n\t\t\t\t\tPS.join(rightRoomid, 'right');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (roomid !== null) {\r\n\t\t\t\tPS.join(roomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\nPS.router = new PSRouter();\r\n\r\nclass PSRoomPanel<T extends PSRoom = PSRoom> extends preact.Component<{room: T}> {\r\n\tsubscriptions: PSSubscription[] = [];\r\n\tcomponentDidMount() {\r\n\t\tif (PS.room === this.props.room) this.focus();\r\n\t\tthis.props.room.onParentEvent = (id: string, e?: Event) => {\r\n\t\t\tif (id === 'focus') this.focus();\r\n\t\t};\r\n\t\tthis.subscriptions.push(this.props.room.subscribe(args => {\r\n\t\t\tif (!args) this.forceUpdate();\r\n\t\t\telse this.receiveLine(args);\r\n\t\t}));\r\n\t\tif (this.base) {\r\n\t\t\tthis.props.room.setDimensions(this.base.offsetWidth, this.base.offsetHeight);\r\n\t\t}\r\n\t}\r\n\tcomponentDidUpdate() {\r\n\t\tif (this.base && ['popup', 'semimodal-popup'].includes(this.props.room.location)) {\r\n\t\t\tthis.props.room.setDimensions(this.base.offsetWidth, this.base.offsetHeight);\r\n\t\t}\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tthis.props.room.onParentEvent = null;\r\n\t\tfor (const subscription of this.subscriptions) {\r\n\t\t\tsubscription.unsubscribe();\r\n\t\t}\r\n\t\tthis.subscriptions = [];\r\n\t}\r\n\treceiveLine(args: Args) {}\r\n\t/**\r\n\t * PS has \"fake select menus\", buttons that act like <select> dropdowns.\r\n\t * This function is used by the popups they open to change the button\r\n\t * values.\r\n\t */\r\n\tchooseParentValue(value: string) {\r\n\t\tconst dropdownButton = this.props.room.parentElem as HTMLButtonElement;\r\n\t\tdropdownButton.value = value;\r\n\t\tconst changeEvent = new Event('change');\r\n\t\tdropdownButton.dispatchEvent(changeEvent);\r\n\t\tPS.closePopup();\r\n\t}\r\n\tfocus() {}\r\n\trender() {\r\n\t\treturn <PSPanelWrapper room={this.props.room}>\r\n\t\t\t<div class=\"mainmessage\"><p>Loading...</p></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nfunction PSPanelWrapper(props: {\r\n\troom: PSRoom, children: preact.ComponentChildren, scrollable?: boolean, width?: number | 'auto',\r\n}) {\r\n\tconst room = props.room;\r\n\tif (room.location === 'mini-window') {\r\n\t\tif (room.id === 'news') {\r\n\t\t\treturn <div>{props.children}</div>;\r\n\t\t}\r\n\t\treturn <div id={`room-${room.id}`} class=\"mini-window-contents ps-room-light\">{props.children}</div>;\r\n\t}\r\n\tif (room.location !== 'left' && room.location !== 'right') {\r\n\t\tconst style = PSMain.getPopupStyle(room, props.width);\r\n\t\treturn <div class=\"ps-popup\" id={`room-${room.id}`} style={style}>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tconst style = PSMain.posStyle(room);\r\n\treturn <div\r\n\t\tclass={'ps-room' + (room.id === '' ? '' : ' ps-room-light') + (props.scrollable ? ' scrollable' : '')}\r\n\t\tid={`room-${room.id}`}\r\n\t\tstyle={style}\r\n\t>\r\n\t\t{props.children}\r\n\t</div>;\r\n}\r\n\r\nclass PSMain extends preact.Component {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tPS.subscribe(() => this.forceUpdate());\r\n\r\n\t\twindow.addEventListener('click', e => {\r\n\t\t\tlet elem = e.target as HTMLElement | null;\r\n\t\t\tif (elem?.className === 'ps-overlay') {\r\n\t\t\t\tPS.closePopup();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet clickedRoom = null;\r\n\t\t\twhile (elem) {\r\n\t\t\t\tif (` ${elem.className} `.includes(' username ')) {\r\n\t\t\t\t\tconst name = elem.getAttribute('data-name');\r\n\t\t\t\t\tconst userid = toID(name);\r\n\t\t\t\t\tconst roomid = `user-${userid}` as RoomID;\r\n\t\t\t\t\tPS.addRoom({\r\n\t\t\t\t\t\tid: roomid,\r\n\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\tparentRoomid: PSMain.containingRoomid(elem),\r\n\t\t\t\t\t\trightPopup: elem.className === 'userbutton username',\r\n\t\t\t\t\t\tusername: name,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tPS.update();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.tagName === 'A' || elem.getAttribute('data-href')) {\r\n\t\t\t\t\tconst roomid = this.roomidFromLink(elem as HTMLAnchorElement);\r\n\t\t\t\t\tif (roomid !== null) {\r\n\t\t\t\t\t\tPS.addRoom({\r\n\t\t\t\t\t\t\tid: roomid,\r\n\t\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tPS.update();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.tagName === 'BUTTON') {\r\n\t\t\t\t\tif (this.handleButtonClick(elem as HTMLButtonElement)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.id.startsWith('room-')) {\r\n\t\t\t\t\tclickedRoom = PS.rooms[elem.id.slice(5)];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telem = elem.parentElement;\r\n\t\t\t}\r\n\t\t\tif (PS.room !== clickedRoom) {\r\n\t\t\t\tif (clickedRoom) PS.room = clickedRoom;\r\n\t\t\t\twhile (PS.popups.length && (!clickedRoom || clickedRoom.id !== PS.popups[PS.popups.length - 1])) {\r\n\t\t\t\t\tPS.closePopup();\r\n\t\t\t\t}\r\n\t\t\t\tPS.update();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('keydown', e => {\r\n\t\t\tlet elem = e.target as HTMLInputElement | null;\r\n\t\t\tif (elem) {\r\n\t\t\t\tlet isTextInput = (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA');\r\n\t\t\t\tif (isTextInput && ['button', 'radio', 'checkbox', 'file'].includes(elem.type)) {\r\n\t\t\t\t\tisTextInput = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (isTextInput && elem.value) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (PS.room.onParentEvent) {\r\n\t\t\t\tif (PS.room.onParentEvent('keydown', e) === false) {\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet modifierKey = e.ctrlKey || e.altKey || e.metaKey || e.shiftKey;\r\n\t\t\tif (modifierKey) return;\r\n\t\t\tif (e.keyCode === 37) { // left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (e.keyCode === 39) { // right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tPS.prefs.subscribeAndRun(key => {\r\n\t\t\tif (!key || key === 'dark') {\r\n\t\t\t\tdocument.body.className = PS.prefs.dark ? 'dark' : '';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tgetRoom(elem: HTMLElement) {\r\n\t\tlet curElem: HTMLElement | null = elem;\r\n\t\twhile (curElem) {\r\n\t\t\tif (curElem.id.startsWith('room-')) {\r\n\t\t\t\treturn PS.rooms[curElem.id.slice(5)];\r\n\t\t\t}\r\n\t\t\tcurElem = curElem.parentElement;\r\n\t\t}\r\n\t}\r\n\thandleButtonClick(elem: HTMLButtonElement) {\r\n\t\tswitch (elem.name) {\r\n\t\tcase 'closeRoom':\r\n\t\t\tPS.leave(elem.value as RoomID);\r\n\t\t\treturn true;\r\n\t\tcase 'joinRoom':\r\n\t\t\tPS.addRoom({\r\n\t\t\t\tid: elem.value as RoomID,\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\tPS.update();\r\n\t\t\treturn true;\r\n\t\tcase 'send':\r\n\t\tcase 'cmd':\r\n\t\t\tconst room = this.getRoom(elem) || PS.mainmenu;\r\n\t\t\troom.send(elem.value, elem.name === 'send');\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\troomidFromLink(elem: HTMLAnchorElement) {\r\n\t\tlet href = elem.getAttribute('data-href');\r\n\t\tif (href) {\r\n\t\t\t// yes that's what we needed\r\n\t\t} else if (PS.server.id === 'showdown') {\r\n\t\t\tif (elem.host && elem.host !== Config.routes.client && elem.host !== 'psim.us') {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\thref = elem.pathname;\r\n\t\t} else {\r\n\t\t\tif (elem.host !== location.host) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\thref = elem.pathname;\r\n\t\t}\r\n\t\tconst roomid = href.slice(1);\r\n\t\tif (!/^[a-z0-9-]*$/.test(roomid)) {\r\n\t\t\treturn null; // not a roomid\r\n\t\t}\r\n\t\tconst redirects = /^(appeals?|rooms?suggestions?|suggestions?|adminrequests?|bugs?|bugreports?|rules?|faq|credits?|news|privacy|contact|dex|insecure)$/;\r\n\t\tif (redirects.test(roomid)) return null;\r\n\t\treturn roomid as RoomID;\r\n\t}\r\n\tstatic containingRoomid(elem: HTMLElement) {\r\n\t\tlet curElem: HTMLElement | null = elem;\r\n\t\twhile (curElem) {\r\n\t\t\tif (curElem.id.startsWith('room-')) {\r\n\t\t\t\treturn curElem.id.slice(5) as RoomID;\r\n\t\t\t}\r\n\t\t\tcurElem = curElem.parentElement;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tstatic isEmptyClick(e: MouseEvent) {\r\n\t\ttry {\r\n\t\t\tconst selection = window.getSelection()!;\r\n\t\t\tif (selection.type === 'Range') return false;\r\n\t\t} catch (err) {}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\tstatic posStyle(room: PSRoom) {\r\n\t\tlet pos: PanelPosition | null = null;\r\n\t\tif (PS.leftRoomWidth === 0) {\r\n\t\t\t// one panel visible\r\n\t\t\tif (room === PS.activePanel) pos = {top: 56};\r\n\t\t} else {\r\n\t\t\t// both panels visible\r\n\t\t\tif (room === PS.leftRoom) pos = {top: 56, right: PS.leftRoomWidth};\r\n\t\t\tif (room === PS.rightRoom) pos = {top: 56, left: PS.leftRoomWidth};\r\n\t\t}\r\n\r\n\t\tif (!pos) return {display: 'none'};\r\n\r\n\t\tlet top: number | null = (pos.top || 0);\r\n\t\tlet height: number | null = null;\r\n\t\tlet bottom: number | null = (pos.bottom || 0);\r\n\t\tif (bottom > 0 || top < 0) {\r\n\t\t\theight = bottom - top;\r\n\t\t\tif (height < 0) throw new RangeError(\"Invalid pos range\");\r\n\t\t\tif (top < 0) top = null;\r\n\t\t\telse bottom = null;\r\n\t\t}\r\n\r\n\t\tlet left: number | null = (pos.left || 0);\r\n\t\tlet width: number | null = null;\r\n\t\tlet right: number | null = (pos.right || 0);\r\n\t\tif (right > 0 || left < 0) {\r\n\t\t\twidth = right - left - 1;\r\n\t\t\tif (width < 0) throw new RangeError(\"Invalid pos range\");\r\n\t\t\tif (left < 0) left = null;\r\n\t\t\telse right = null;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdisplay: 'block',\r\n\t\t\ttop: top === null ? `auto` : `${top}px`,\r\n\t\t\theight: height === null ? `auto` : `${height}px`,\r\n\t\t\tbottom: bottom === null ? `auto` : `${-bottom}px`,\r\n\t\t\tleft: left === null ? `auto` : `${left}px`,\r\n\t\t\twidth: width === null ? `auto` : `${width}px`,\r\n\t\t\tright: right === null ? `auto` : `${-right}px`,\r\n\t\t};\r\n\t}\r\n\tstatic getPopupStyle(room: PSRoom, width?: number | 'auto'): any {\r\n\t\tif (room.location === 'modal-popup' || !room.parentElem) {\r\n\t\t\treturn {width: width || 480};\r\n\t\t}\r\n\t\tif (!room.width || !room.height) {\r\n\t\t\treturn {\r\n\t\t\t\tposition: 'absolute',\r\n\t\t\t\tvisibility: 'hidden',\r\n\t\t\t\tmargin: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t\t// nonmodal popup: should be positioned near source element\r\n\t\tlet style: any = {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tmargin: 0,\r\n\t\t};\r\n\t\tlet offset = room.parentElem.getBoundingClientRect();\r\n\t\tlet sourceWidth = offset.width;\r\n\t\tlet sourceHeight = offset.height;\r\n\r\n\t\tlet availableHeight = document.documentElement.clientHeight;\r\n\t\tlet height = room.height;\r\n\t\twidth = width || room.width;\r\n\r\n\t\tif (room.rightPopup) {\r\n\r\n\t\t\tif (availableHeight > offset.top + height + 5 &&\r\n\t\t\t\t(offset.top < availableHeight * 2 / 3 || offset.top + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = offset.top;\r\n\t\t\t} else if (offset.top + sourceHeight >= height) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - offset.top - sourceHeight, 0);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = Math.max(0, availableHeight - height);\r\n\t\t\t}\r\n\t\t\tlet offsetLeft = offset.left + sourceWidth;\r\n\t\t\tif (width !== 'auto' && offsetLeft + width > document.documentElement.clientWidth) {\r\n\t\t\t\tstyle.right = 1;\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = offsetLeft;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif (availableHeight > offset.top + sourceHeight + height + 5 &&\r\n\t\t\t\t(offset.top + sourceHeight < availableHeight * 2 / 3 || offset.top + sourceHeight + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = offset.top + sourceHeight;\r\n\t\t\t} else if (height + 5 <= offset.top) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - offset.top, 0);\r\n\t\t\t} else if (height + 10 < availableHeight) {\r\n\t\t\t\tstyle.bottom = 5;\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = 0;\r\n\t\t\t}\r\n\r\n\t\t\tlet availableWidth = document.documentElement.clientWidth - offset.left;\r\n\t\t\tif (width !== 'auto' && availableWidth < width + 10) {\r\n\t\t\t\tstyle.right = 10;\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = offset.left;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (width) style.maxWidth = width;\r\n\r\n\t\treturn style;\r\n\t}\r\n\trenderRoom(room: PSRoom) {\r\n\t\tconst roomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\trenderPopup(room: PSRoom) {\r\n\t\tconst roomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\r\n\t\tif (room.location === 'popup' && room.parentElem) {\r\n\t\t\treturn <Panel key={room.id} room={room} />;\r\n\t\t}\r\n\t\treturn <div key={room.id} class=\"ps-overlay\">\r\n\t\t\t<Panel room={room} />\r\n\t\t</div>;\r\n\t}\r\n\trender() {\r\n\t\tlet rooms = [] as preact.VNode[];\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\tif (room.location === 'left' || room.location === 'right') {\r\n\t\t\t\trooms.push(this.renderRoom(room));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div class=\"ps-frame\">\r\n\t\t\t<PSHeader style={{top: 0, left: 0, right: 0, height: '50px'}} />\r\n\t\t\t{rooms}\r\n\t\t\t{PS.popups.map(roomid => this.renderPopup(PS.rooms[roomid]!))}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\ntype PanelPosition = {top?: number, bottom?: number, left?: number, right?: number} | null;"],"mappings":"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"}